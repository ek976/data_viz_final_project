---
title: "Lab 4: An opinionated introduction to Javascript"
author: "Tiana Le"
draft: true
 # include-in-header:
 #   - text: |
 #         <script src="https://d3js.org/d3.v7.min.js"></script>

---

```{ojs}
//| echo: fenced
// Include access to the d3.js version 7 package 
d7 = require('d3@7') 
dat_d7 = d7.csv('govt_spend_primary.csv', function(d){
  return {
    series_name: d.series_name,
    country_name: d.country_name,
    country_code: d.country_code,
    year: +d.year,
    value: +d.value
  }
})
dat_d7
```


```{ojs}
_ = require('underscore');

// Define keys and index
keys = _.uniq(dat_d7.map((d) => d.country_name));
index = new Map(keys.map((key, i) => [key, i]));
nCols = 4;

// Define fx and fy functions
fy = (key) => (Math.floor(index.get(key) / nCols));
fx = (key) => (index.get(key) % nCols);

Plot.plot({
  width: 1000, // editted here
  title: "Government Expenditure in Education",
  subtitle:
    "Government expenditure per student, primary (% of GDP per capita).",
  caption: md`**ADD CAPTION**`,
  color: {
    label: "Expenditure (%)",
    percent: false,
    legend: true,
    scheme: "PuBuGn"
  },
  x: {
    axis: "bottom"
  },
  y: {
    label: null,
    domain: [0, 100],
    percent: false,
    grid: true,
    ticks: [0, 100]
  },
  facet: { label: null },
  fx: { axis: null, padding: 0.03},
  fy: { axis: null },
  marks: [
    Plot.areaY(dat_d7, { // edits here
      x: "year",
      y: "value",
      fill: "value",
      color: "#00000000",
      z: "null",
      fx: (d) => fx(d.country_name),
      fy: (d) => fy(d.country_name),
      strokeWidth: 0.05,
      curve: "catmull-rom",
      tip: true
    }),
    Plot.text(keys, { fx, fy, frameAnchor: "top-left", dx: 6, dy: 6 }),
    Plot.frame({ strokeWidth: 0.5 })
  ]
})

```


{
  "hash": "5d15eaf34c656a79f60ab7ca0999b730",
  "result": {
    "markdown": "---\ntitle: \"Split Packed Bubble Plot\"\nauthor: \"Jorge Bris Moreno\"\nformat:\n    html:\n        embed-resources: true\n        code-fold: true\n        toc: true\n        before_body: scripts.html\n---\n\n::: {.cell runtime='js'}\n\n<script src=\"https://code.highcharts.com/highcharts.js\"></script>\n<script src=\"https://code.highcharts.com/highcharts-more.js\"></script>\n<script src=\"https://code.highcharts.com/modules/exporting.js\"></script>\n<script src=\"https://code.highcharts.com/modules/export-data.js\"></script>\n<script src=\"https://code.highcharts.com/modules/accessibility.js\"></script>\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Libraries\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(viridis)\nlibrary(jsonlite)\n\n# read df\ndf <- read_csv(\"../cleaned_data/filtered_education_data.csv\")\n\n# Select the indicators\nindicators <- c(\"Gross enrolment ratio, lower secondary, female (%)\",\n                \"Gross enrolment ratio, post-secondary non-tertiary, female (%)\",\n                \"Gross enrolment ratio, pre-primary, female (%)\",\n                \"Gross enrolment ratio, primary, female (%)\",\n                \"Gross enrolment ratio, secondary, female (%)\",\n                \"Gross enrolment ratio, tertiary, female (%)\",\n                \"Gross enrolment ratio, upper secondary, female (%)\")\n\n# Filter the data\ndata_filtered <- df %>%\n  filter(`Country Name` %in% c(\"Arab World\", \"East Asia & Pacific\", \"Euro area\", \"Europe & Central Asia\", \"Heavily indebted poor countries (HIPC)\", \"Latin America & Caribbean (excluding high income)\", \"Middle East & North Africa\", \"Middle East & North Africa (excluding high income)\", \"OECD members\", \"Sub-Saharan Africa (excluding high income)\")) %>%\n  filter(`Indicator Name` %in% indicators)\n\n# Rename the indicators\nnew_names <- c(\"lower secondary\", \"post-secondary non-tertiary\", \"pre-primary\", \n               \"primary\", \"secondary\", \"tertiary\", \"upper secondary\")\n\n# Create a mapping between the old and new names\nnames_mapping <- setNames(new_names, indicators)\n\n# Rename the indicators\ndata_filtered$`Indicator Name` <- names_mapping[data_filtered$`Indicator Name`]\n\n# Select and rename columns\ndata_final <- data_filtered %>%\n  select(`Country Name`, `Indicator Name`, `2014`) %>%\n  rename(Value = `2014`, Indicator = `Indicator Name`)\n\n# print data\nprint(data_final)\n\n# json format\ndf_json <- toJSON(data_final, dataframe = \"columns\")\n\n# print json format to manually paste\ndf_json\n```\n:::\n\n```{ojs}\n// Define the initial dataset\ninitialData = [\n  {\"Country Name\":\"Arab World\",\"Indicator\":\"lower secondary\",\"Value\":81.054},\n  {\"Country Name\":\"Arab World\",\"Indicator\":\"post-secondary non-tertiary\",\"Value\":\"NA\"},\n  {\"Country Name\":\"Arab World\",\"Indicator\":\"pre-primary\",\"Value\":25.3707},\n  {\"Country Name\":\"Arab World\",\"Indicator\":\"primary\",\"Value\":93.608},\n  {\"Country Name\":\"Arab World\",\"Indicator\":\"secondary\",\"Value\":67.9689},\n  {\"Country Name\":\"Arab World\",\"Indicator\":\"tertiary\",\"Value\":28.768},\n  {\"Country Name\":\"Arab World\",\"Indicator\":\"upper secondary\",\"Value\":54.5065},\n  {\"Country Name\":\"East Asia & Pacific\",\"Indicator\":\"lower secondary\",\"Value\":96.6641},\n  {\"Country Name\":\"East Asia & Pacific\",\"Indicator\":\"post-secondary non-tertiary\",\"Value\":\"NA\"},\n  {\"Country Name\":\"East Asia & Pacific\",\"Indicator\":\"pre-primary\",\"Value\":76.0034},\n  {\"Country Name\":\"East Asia & Pacific\",\"Indicator\":\"primary\",\"Value\":104.9668},\n  {\"Country Name\":\"East Asia & Pacific\",\"Indicator\":\"secondary\",\"Value\":88.3206},\n  {\"Country Name\":\"East Asia & Pacific\",\"Indicator\":\"tertiary\",\"Value\":41.4262},\n  {\"Country Name\":\"East Asia & Pacific\",\"Indicator\":\"upper secondary\",\"Value\":79.7367},\n  {\"Country Name\":\"Euro area\",\"Indicator\":\"lower secondary\",\"Value\":108.7706},\n  {\"Country Name\":\"Euro area\",\"Indicator\":\"post-secondary non-tertiary\",\"Value\":\"NA\"},\n  {\"Country Name\":\"Euro area\",\"Indicator\":\"pre-primary\",\"Value\":102.3132},\n  {\"Country Name\":\"Euro area\",\"Indicator\":\"primary\",\"Value\":103.4798},\n  {\"Country Name\":\"Euro area\",\"Indicator\":\"secondary\",\"Value\":110.7075},\n  {\"Country Name\":\"Euro area\",\"Indicator\":\"tertiary\",\"Value\":76.299},\n  {\"Country Name\":\"Euro area\",\"Indicator\":\"upper secondary\",\"Value\":112.9169},\n  {\"Country Name\":\"Europe & Central Asia\",\"Indicator\":\"lower secondary\",\"Value\":103.7713},\n  {\"Country Name\":\"Europe & Central Asia\",\"Indicator\":\"post-secondary non-tertiary\",\"Value\":\"NA\"},\n  {\"Country Name\":\"Europe & Central Asia\",\"Indicator\":\"pre-primary\",\"Value\":74.2163},\n  {\"Country Name\":\"Europe & Central Asia\",\"Indicator\":\"primary\",\"Value\":103.1583},\n  {\"Country Name\":\"Europe & Central Asia\",\"Indicator\":\"secondary\",\"Value\":105.389},\n  {\"Country Name\":\"Europe & Central Asia\",\"Indicator\":\"tertiary\",\"Value\":69.8713},\n  {\"Country Name\":\"Europe & Central Asia\",\"Indicator\":\"upper secondary\",\"Value\":107.4027},\n  {\"Country Name\":\"Heavily indebted poor countries (HIPC)\",\"Indicator\":\"lower secondary\",\"Value\":\"NA\"},\n  {\"Country Name\":\"Heavily indebted poor countries (HIPC)\",\"Indicator\":\"post-secondary non-tertiary\",\"Value\":18.0427},\n  {\"Country Name\":\"Heavily indebted poor countries (HIPC)\",\"Indicator\":\"pre-primary\",\"Value\":98.0805},\n  {\"Country Name\":\"Heavily indebted poor countries (HIPC)\",\"Indicator\":\"primary\",\"Value\":35.621},\n  {\"Country Name\":\"Heavily indebted poor countries (HIPC)\",\"Indicator\":\"secondary\",\"Value\":6.233},\n  {\"Country Name\":\"Heavily indebted poor countries (HIPC)\",\"Indicator\":\"tertiary\",\"Value\":24.4659},\n  {\"Country Name\":\"Heavily indebted poor countries (HIPC)\",\"Indicator\":\"upper secondary\",\"Value\":108.0586},\n  {\"Country Name\":\"Latin America & Caribbean (excluding high income)\",\"Indicator\":\"lower secondary\",\"Value\":\"NA\"},\n  {\"Country Name\":\"Latin America & Caribbean(excluding high income)\",\"Indicator\":\"post-secondary non-tertiary\",\"Value\":72.4493},\n  {\"Country Name\":\"Latin America & Caribbean (excluding high income)\",\"Indicator\":\"pre-primary\",\"Value\":107.3809},\n  {\"Country Name\":\"Latin America & Caribbean (excluding high income)\",\"Indicator\":\"primary\",\"Value\":97.1722},\n  {\"Country Name\":\"Latin America & Caribbean (excluding high income)\",\"Indicator\":\"secondary\",\"Value\":48.967},\n  {\"Country Name\":\"Latin America & Caribbean (excluding high income)\",\"Indicator\":\"tertiary\",\"Value\":84.4792},\n  {\"Country Name\":\"Latin America & Caribbean (excluding high income)\",\"Indicator\":\"upper secondary\",\"Value\":88.4424},\n  {\"Country Name\":\"Middle East & North Africa\",\"Indicator\":\"lower secondary\",\"Value\":\"NA\"},\n  {\"Country Name\":\"Middle East & North Africa\",\"Indicator\":\"post-secondary non-tertiary\",\"Value\":29.5462},\n  {\"Country Name\":\"Middle East & North Africa\",\"Indicator\":\"pre-primary\",\"Value\":103.047},\n  {\"Country Name\":\"Middle East & North Africa\",\"Indicator\":\"primary\",\"Value\":76.9069},\n  {\"Country Name\":\"Middle East & North Africa\",\"Indicator\":\"secondary\",\"Value\":38.2514},\n  {\"Country Name\":\"Middle East & North Africa\",\"Indicator\":\"tertiary\",\"Value\":65.6759},\n  {\"Country Name\":\"Middle East & North Africa\",\"Indicator\":\"upper secondary\",\"Value\":86.992},\n  {\"Country Name\":\"Middle East & North Africa (excluding high income)\",\"Indicator\":\"lower secondary\",\"Value\":\"NA\"},\n  {\"Country Name\":\"Middle East & North Africa (excluding high income)\",\"Indicator\":\"post-secondary non-tertiary\",\"Value\":26.8679},\n  {\"Country Name\":\"Middle East & North Africa (excluding high income)\",\"Indicator\":\"pre-primary\",\"Value\":102.4904},\n  {\"Country Name\":\"Middle East & North Africa (excluding high income)\",\"Indicator\":\"primary\",\"Value\":74.3971},\n  {\"Country Name\":\"Middle East & North Africa (excluding high income)\",\"Indicator\":\"secondary\",\"Value\":36.1012},\n  {\"Country Name\":\"Middle East & North Africa (excluding high income)\",\"Indicator\":\"tertiary\",\"Value\":62.3747},\n  {\"Country Name\":\"Middle East & North Africa (excluding high income)\",\"Indicator\":\"upper secondary\",\"Value\":107.3207},\n  {\"Country Name\":\"OECD members\",\"Indicator\":\"lower secondary\",\"Value\":79.3329},\n  {\"Country Name\":\"OECD members\",\"Indicator\":\"post-secondary non-tertiary\",\"Value\":\"NA\"},\n  {\"Country Name\":\"OECD members\",\"Indicator\":\"pre-primary\",\"Value\":102.2592},\n  {\"Country Name\":\"OECD members\",\"Indicator\":\"primary\",\"Value\":104.3177},\n  {\"Country Name\":\"OECD members\",\"Indicator\":\"secondary\",\"Value\":75.5335},\n  {\"Country Name\":\"OECD members\",\"Indicator\":\"tertiary\",\"Value\":101.3419},\n  {\"Country Name\":\"OECD members\",\"Indicator\":\"upper secondary\",\"Value\":46.1386},\n  {\"Country Name\":\"Sub-Saharan Africa (excluding high income)\",\"Indicator\":\"lower secondary\",\"Value\":\"NA\"},\n  {\"Country Name\":\"Sub-Saharan Africa (excluding high income)\",\"Indicator\":\"post-secondary non-tertiary\",\"Value\":22.0271},\n  {\"Country Name\":\"Sub-Saharan Africa (excluding high income)\",\"Indicator\":\"pre-primary\",\"Value\":94.7689},\n  {\"Country Name\":\"Sub-Saharan Africa (excluding high income)\",\"Indicator\":\"primary\",\"Value\":39.5373},\n  {\"Country Name\":\"Sub-Saharan Africa (excluding high income)\",\"Indicator\":\"secondary\",\"Value\":7.2426},\n  {\"Country Name\":\"Sub-Saharan Africa (excluding high income)\",\"Indicator\":\"tertiary\",\"Value\":31.7493},\n  {\"Country Name\":\"Sub-Saharan Africa (excluding high income)\",\"Indicator\":\"upper secondary\",\"Value\":108.0586}\n];\n\n// Filter and parse the dataset to remove \"NA\" values and convert \"Value\" to float\nparsedData = initialData.filter(d => d.Value !== \"NA\").map(d => ({\n  ...d,\n  Value: parseFloat(d.Value)\n}));\n\n// Reduce the data to group it by \"Country Name\" and accumulate the indicators and values\nseriesData = parsedData.reduce((acc, { \"Country Name\": countryName, Indicator, Value }) => {\n  let group = acc.find(g => g.name === countryName);\n  if (!group) {\n    group = { name: countryName, data: [] };\n    acc.push(group);\n  }\n  group.data.push({ name: Indicator, value: Value });\n  return acc;\n}, []);\n```\n\n```{ojs}\nhex_colors = [\n    \"#3d6469\", \"#af882e\", \"#ff8f04\", \"#ff5901\", \"#9c2b04\", \"#0b060c\", \"#9c9080\", \"#f5bdae\",\"#dc3455\", \"#a4072e\", \"#5f0922\"\n]\n\nfunction renderChart() {\n    Highcharts.chart('container', {\n        chart: {\n            type: 'packedbubble',\n            height: '100%'\n        },\n        title: {\n            text: 'Female Gross Enrollment Ratios by Region (2014)'\n        },\n        tooltip: {\n            useHTML: true,\n            pointFormat: '<b>{point.name}:</b> {point.value}%'\n        },\n        plotOptions: {\n            packedbubble: {\n                minSize: '10%',\n                maxSize: '100%',\n                zMin: 0,\n                zMax: 400,\n                layoutAlgorithm: {\n                    gravitationalConstant: 0.05,\n                    splitSeries: true,\n                    seriesInteraction: false,\n                    dragBetweenSeries: true,\n                    parentNodeLimit: true\n                },\n                dataLabels: {\n                    enabled: true,\n                    format: '{point.name}',\n                    style: {\n                        color: 'black',\n                        textOutline: 'none',\n                        fontWeight: 'normal'\n                    }\n                }\n            }\n        },\n        series: seriesData.map((series, index) => ({\n           ...series,\n            color: hex_colors[index % hex_colors.length]\n        }))\n    });\n};\n\nrenderChart();\n```\n\n\n<figure>\n  <div id=\"container\"></div>\n  <figcaption>This chart shows the Female Gross Enrollment Ratios by Region for the year 2014. These region delimitations have been chosen from what global organizations like the World Bank utilize for their studies. You can select and deselect regions to focus on different regions, each bubble inside the region represents an education level, and the values inside are the female gross enrollment ration for 2014. The sizes of the bubbles correlate to the values. If levels of education are not present in a region is due to the lack of information about that specific combination of education level and region.</figcaption>\n</figure>",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}